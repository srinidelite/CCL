
/*=====================================================================================================================================
                                        SOURCE - WEBCASH , VAULT , MDM -CHE
===================================================================================================================================== */
/*=============================================================================
===============================================
=========
SOURCE - WEBCASH , VAULT , MDM -CHE - modified 
===============================================================================
===============================================
======= */
SELECT
  CASE
    WHEN BNK.BANK_ACCT_KEY IS NULL
    THEN VLT.BANK_ACCT_KEY
    ELSE BNK.BANK_ACCT_KEY
  END AS BANK_ACCT_KEY,
  CASE
    WHEN BNK.BANK_ACCT_ID IS NULL
    THEN VLT.BANK_ACCT_ID
    ELSE BNK.BANK_ACCT_ID
  END AS BANK_ACCT_ID,
  CASE
    WHEN BNK.TREAS_CODE IS NULL
    THEN VLT.TREAS_CODE
    ELSE BNK.TREAS_CODE
  END AS TREAS_CODE,
  CASE
    WHEN BNK.ACCT_NBR_TEXT IS NULL
    THEN VLT.ACCT_NBR_TEXT
    ELSE BNK.ACCT_NBR_TEXT
  END AS ACCT_NBR_TEXT,
  CASE
    WHEN BNK.ACCT_OPEN_DATE IS NULL
    THEN VLT.ACCT_OPEN_DATE
    ELSE BNK.ACCT_OPEN_DATE
  END AS ACCT_OPEN_DATE,
  CASE
    WHEN BNK.ACCT_CLOS_DATE IS NULL
    THEN VLT.ACCT_CLOS_DATE
    ELSE BNK.ACCT_CLOS_DATE
  END AS ACCT_CLOS_DATE,
  CASE
    WHEN BNK.ACCT_PURP_DESC IS NULL
    THEN VLT.ACCT_PURP_DESC
    ELSE BNK.ACCT_PURP_DESC
  END AS ACCT_PURP_DESC,
  CASE
    WHEN BNK.ACCT_TYPE_CODE IS NULL
    THEN VLT.ACCT_TYPE_CODE
    ELSE BNK.ACCT_TYPE_CODE
  END AS ACCT_TYPE_CODE,
  CASE
    WHEN BNK.ACCT_TYPE_NM IS NULL
    THEN VLT.ACCT_TYPE_NM
    ELSE BNK.ACCT_TYPE_NM
  END AS ACCT_TYPE_NM,
  CASE
    WHEN BNK.ACCT_CURR_CODE IS NULL
    THEN VLT.ACCT_CURR_CODE
    ELSE BNK.ACCT_CURR_CODE
  END AS ACCT_CURR_CODE,
  CASE
    WHEN BNK.ACCT_USED_BY_GE_FLAG IS NULL
    THEN VLT.ACCT_USED_BY_GE_FLAG
    ELSE BNK.ACCT_USED_BY_GE_FLAG
  END AS ACCT_USED_BY_GE_FLAG,
  CASE
    WHEN BNK.ACCT_HOLD_NM IS NULL
    THEN VLT.ACCT_HOLD_NM
    ELSE BNK.ACCT_HOLD_NM
  END AS ACCT_HOLD_NM,
  CASE
    WHEN BNK.ACCT_IDNTY_TYPE_CODE IS NULL
    THEN VLT.ACCT_IDNTY_TYPE_CODE
    ELSE BNK.ACCT_IDNTY_TYPE_CODE
  END AS ACCT_IDNTY_TYPE_CODE,
  CASE
    WHEN BNK.ACCT_VALID_FLAG IS NULL
    THEN VLT.ACCT_VALID_FLAG
    ELSE BNK.ACCT_VALID_FLAG
  END AS ACCT_VALID_FLAG,
  CASE
    WHEN BNK.ACCT_REF_AACCTMAP_DESC IS NULL
    THEN VLT.ACCT_REF_AACCTMAP_DESC
    ELSE BNK.ACCT_REF_AACCTMAP_DESC
  END AS ACCT_REF_AACCTMAP_DESC,
  CASE
    WHEN BNK.ACCT_REF_AGRADSCT_DESC IS NULL
    THEN VLT.ACCT_REF_AGRADSCT_DESC
    ELSE BNK.ACCT_REF_AGRADSCT_DESC
  END AS ACCT_REF_AGRADSCT_DESC,
  CASE
    WHEN BNK.ACCT_REF_ASWEEP_DESC IS NULL
    THEN VLT.ACCT_REF_ASWEEP_DESC
    ELSE BNK.ACCT_REF_ASWEEP_DESC
  END AS ACCT_REF_ASWEEP_DESC,
  CASE
    WHEN BNK.ACCT_REF_AGLACCT_DESC IS NULL
    THEN VLT.ACCT_REF_AGLACCT_DESC
    ELSE BNK.ACCT_REF_AGLACCT_DESC
  END AS ACCT_REF_AGLACCT_DESC,
  CASE
    WHEN BNK.ACCT_REF_AGRADSDD_DESC IS NULL
    THEN VLT.ACCT_REF_AGRADSDD_DESC
    ELSE BNK.ACCT_REF_AGRADSDD_DESC
  END AS ACCT_REF_AGRADSDD_DESC,
  CASE
    WHEN BNK.PARNT_BCD IS NULL
    THEN VLT.PARNT_BCD
    ELSE BNK.PARNT_BCD
  END AS PARNT_BCD,
  CASE
    WHEN BNK.PARNT_BANK_NM IS NULL
    THEN VLT.PARNT_BANK_NM
    ELSE BNK.PARNT_BANK_NM
  END AS PARNT_BANK_NM,
  CASE
    WHEN BNK.BANK_NM IS NULL
    THEN VLT.BANK_NM
    ELSE BNK.BANK_NM
  END AS BANK_NM,
  CASE
    WHEN BNK.BANK_SHORT_NM IS NULL
    THEN VLT.BANK_SHORT_NM
    ELSE BNK.BANK_SHORT_NM
  END AS BANK_SHORT_NM,
  CASE
    WHEN BNK.BANK_ADDR_1_TEXT IS NULL
    THEN VLT.BANK_ADDR_1_TEXT
    ELSE BNK.BANK_ADDR_1_TEXT
  END AS BANK_ADDR_1_TEXT,
  CASE
    WHEN BNK.BANK_ADDR_2_TEXT IS NULL
    THEN VLT.BANK_ADDR_2_TEXT
    ELSE BNK.BANK_ADDR_2_TEXT
  END AS BANK_ADDR_2_TEXT,
  CASE
    WHEN BNK.BANK_ADDR_3_TEXT IS NULL
    THEN VLT.BANK_ADDR_3_TEXT
    ELSE BNK.BANK_ADDR_3_TEXT
  END AS BANK_ADDR_3_TEXT,
  CASE
    WHEN BNK.BANK_ADDR_4_TEXT IS NULL
    THEN VLT.BANK_ADDR_4_TEXT
    ELSE BNK.BANK_ADDR_4_TEXT
  END AS BANK_ADDR_4_TEXT,
  CASE
    WHEN BNK.BANK_CITY_NM IS NULL
    THEN VLT.BANK_CITY_NM
    ELSE BNK.BANK_CITY_NM
  END AS BANK_CITY_NM,
  CASE
    WHEN BNK.BANK_STA_NM IS NULL
    THEN VLT.BANK_STA_NM
    ELSE BNK.BANK_STA_NM
  END AS BANK_STA_NM,
  CASE
    WHEN BNK.BANK_PCDE IS NULL
    THEN VLT.BANK_PCDE
    ELSE BNK.BANK_PCDE
  END AS BANK_PCDE,
  CASE
    WHEN BNK.BANK_CNTRY_CODE IS NULL
    THEN VLT.BANK_CNTRY_CODE
    ELSE BNK.BANK_CNTRY_CODE
  END AS BANK_CNTRY_CODE,
  CASE
    WHEN BNK.BANK_CNTRY_NM IS NULL
    THEN VLT.BANK_CNTRY_NM
    ELSE BNK.BANK_CNTRY_NM
  END AS BANK_CNTRY_NM,
  CASE
    WHEN BNK.BANK_ACTV_FLAG IS NULL
    THEN VLT.BANK_ACTV_FLAG
    ELSE BNK.BANK_ACTV_FLAG
  END AS BANK_ACTV_FLAG,
  --CASE
  --WHEN BNK.BANK_DSABL_DATE IS NULL THEN VLT.BANK_DSABL_DATE
  --ELSE BNK.BANK_DSABL_DATE
  --END AS BANK_DSABL_DATE,
  CASE
    WHEN BNK.PREF_BANK_FLAG IS NULL
    THEN VLT.PREF_BANK_FLAG
    ELSE BNK.PREF_BANK_FLAG
  END AS PREF_BANK_FLAG,
  CASE
    WHEN BNK.ACCT_BR_SHORT_NM IS NULL
    THEN VLT.ACCT_BR_SHORT_NM
    ELSE BNK.ACCT_BR_SHORT_NM
  END AS ACCT_BR_SHORT_NM,
  CASE
    WHEN BNK.BR_DESC IS NULL
    THEN VLT.BR_DESC
    ELSE BNK.BR_DESC
  END AS BR_DESC,
  CASE
    WHEN BNK.BR_ADDR_TEXT IS NULL
    THEN VLT.BR_ADDR_TEXT
    ELSE BNK.BR_ADDR_TEXT
  END AS BR_ADDR_TEXT,
  CASE
    WHEN BNK.BR_CITY_NM IS NULL
    THEN VLT.BR_CITY_NM
    ELSE BNK.BR_CITY_NM
  END AS BR_CITY_NM,
  CASE
    WHEN BNK.BR_STA_NM IS NULL
    THEN VLT.BR_STA_NM
    ELSE BNK.BR_STA_NM
  END AS BR_STA_NM,
  CASE
    WHEN BNK.BR_PCDE IS NULL
    THEN VLT.BR_PCDE
    ELSE BNK.BR_PCDE
  END AS BR_PCDE,
  CASE
    WHEN BNK.BR_CNTRY_CODE IS NULL
    THEN VLT.BR_CNTRY_CODE
    ELSE BNK.BR_CNTRY_CODE
  END AS BR_CNTRY_CODE,
  CASE
    WHEN BNK.BR_ACTV_FLAG IS NULL
    THEN VLT.BR_ACTV_FLAG
    ELSE BNK.BR_ACTV_FLAG
  END AS BR_ACTV_FLAG,
  --CASE
  --WHEN BNK.BR_DSABL_DATE IS NULL THEN VLT.BR_DSABL_DATE
  --ELSE BNK.BR_DSABL_DATE
  --END AS BR_DSABL_DATE,
  CASE
    WHEN BNK.MNGMT_ENT_CODE IS NULL
    THEN VLT.MNGMT_ENT_CODE
    ELSE BNK.MNGMT_ENT_CODE
  END AS MNGMT_ENT_CODE,
  CASE
    WHEN BNK.LGL_ENT_GOLD_ID_CODE IS NULL
    THEN VLT.LGL_ENT_GOLD_ID_CODE
    ELSE BNK.LGL_ENT_GOLD_ID_CODE
  END AS LGL_ENT_GOLD_ID_CODE,
  CASE
    WHEN BNK.SRCE_SYS_CODE IS NOT NULL
    AND VLT.SRCE_SYS_CODE  IS NOT NULL
    THEN 'WB_VLT'
    WHEN BNK.SRCE_SYS_CODE IS NULL
    THEN VLT.SRCE_SYS_CODE
    WHEN VLT.SRCE_SYS_CODE IS NULL
    THEN BNK.SRCE_SYS_CODE
  END AS SRCE_SYS_CODE,
  CASE
    WHEN BNK.SRCE_SYS_NM IS NOT NULL
    AND VLT.SRCE_SYS_NM  IS NOT NULL
    THEN 'WB_VLT'
    WHEN BNK.SRCE_SYS_NM IS NULL
    THEN VLT.SRCE_SYS_NM
    WHEN VLT.SRCE_SYS_NM IS NULL
    THEN BNK.SRCE_SYS_NM
  END AS SRCE_SYS_NM,
  CASE
    WHEN BNK.EFF_DATE IS NULL
    THEN VLT.EFF_DATE
    ELSE BNK.EFF_DATE
  END AS EFF_DATE,
  CASE
    WHEN BNK.EXPIRN_DATE IS NULL
    THEN VLT.EXPIRN_DATE
    ELSE BNK.EXPIRN_DATE
  END AS EXPIRN_DATE,
  CASE
    WHEN BNK.ACTV_FLAG IS NULL
    THEN VLT.ACTV_FLAG
    ELSE BNK.ACTV_FLAG
  END AS ACTV_FLAG,
  CASE
    WHEN BNK.ACCT_MNGMT_CODE IS NULL
    THEN VLT.ACCT_MNGMT_CODE
    ELSE BNK.ACCT_MNGMT_CODE
  END AS ACCT_MNGMT_CODE,
  CASE
    WHEN BNK.GRND_PARNT_BUS_GRP_NAME IS NULL
    THEN VLT.GRND_PARNT_BUS_GRP_NAME
    ELSE BNK.GRND_PARNT_BUS_GRP_NAME
  END AS GRND_PARNT_BUS_GRP_NAME,
  CASE
    WHEN BNK.GRND_PARNT_BUS_GRP_CODE IS NULL
    THEN VLT.GRND_PARNT_BUS_GRP_CODE
    ELSE BNK.GRND_PARNT_BUS_GRP_CODE
  END AS GRND_PARNT_BUS_GRP_CODE,
  CASE
    WHEN BNK.GRND_PARNT_BUS_GRP_DESC IS NULL
    THEN VLT.GRND_PARNT_BUS_GRP_DESC
    ELSE BNK.GRND_PARNT_BUS_GRP_DESC
  END AS GRND_PARNT_BUS_GRP_DESC,
  CASE
    WHEN BNK.PARNT_BUS_GRP_NAME IS NULL
    THEN VLT.PARNT_BUS_GRP_NAME
    ELSE BNK.PARNT_BUS_GRP_NAME
  END AS PARNT_BUS_GRP_NAME,
  CASE
    WHEN BNK.PARNT_BUS_GRP_CODE IS NULL
    THEN VLT.PARNT_BUS_GRP_CODE
    ELSE BNK.PARNT_BUS_GRP_CODE
  END AS PARNT_BUS_GRP_CODE,
  CASE
    WHEN BNK.PARNT_BUS_GRP_DESC IS NULL
    THEN VLT.PARNT_BUS_GRP_DESC
    ELSE BNK.PARNT_BUS_GRP_DESC
  END AS PARNT_BUS_GRP_DESC,
  CASE
    WHEN BNK.BUS_GRP_NAME IS NULL
    THEN VLT.BUS_GRP_NAME
    ELSE BNK.BUS_GRP_NAME
  END AS BUS_GRP_NAME,
  CASE
    WHEN BNK.BUS_GRP_CODE IS NULL
    THEN VLT.BUS_GRP_CODE
    ELSE BNK.BUS_GRP_CODE
  END AS BUS_GRP_CODE,
  CASE
    WHEN BNK.BUS_GRP_DESC IS NULL
    THEN VLT.BUS_GRP_DESC
    ELSE BNK.BUS_GRP_DESC
  END AS BUS_GRP_DESC,
  CASE
    WHEN BNK.BSLA_TYPE_CODE IS NULL
    THEN VLT.BSLA_TYPE_CODE
    ELSE BNK.BSLA_TYPE_CODE
  END AS BSLA_TYPE_CODE,
  CASE
    WHEN BNK.BSLA IS NULL
    THEN VLT.BSLA
    ELSE BNK.BSLA
  END AS BSLA,
  CASE
    WHEN BNK.DR4 IS NULL
    THEN VLT.DR4
    ELSE BNK.DR4
  END AS DR4,
  CASE
    WHEN BNK.ACCT_STATUS_DESC IS NULL
    THEN VLT.ACCT_STATUS_DESC
    ELSE BNK.ACCT_STATUS_DESC
  END AS ACCT_STATUS_DESC,
  CASE
    WHEN BNK.IS_CASH_POOL_FLAG IS NULL
    THEN VLT.IS_CASH_POOL_FLAG
    ELSE BNK.IS_CASH_POOL_FLAG
  END AS IS_CASH_POOL_FLAG,
  CASE
    WHEN BNK.RGN_ID IS NULL
    THEN VLT.RGN_ID
    ELSE BNK.RGN_ID
  END AS RGN_ID,
  CASE
    WHEN BNK.INTL_ACCT_NBR IS NULL
    THEN VLT.INTL_ACCT_NBR
    ELSE BNK.INTL_ACCT_NBR
  END AS INTL_ACCT_NBR,
  CASE
    WHEN BNK.NATL_ACCT_NBR IS NULL
    THEN VLT.NATL_ACCT_NBR
    ELSE BNK.NATL_ACCT_NBR
  END AS NATL_ACCT_NBR,
  CASE
    WHEN BNK.CORP_POOLHDR_CHAR_VAL IS NULL
    THEN VLT.CORP_POOLHDR_CHAR_VAL
    ELSE BNK.CORP_POOLHDR_CHAR_VAL
  END AS CORP_POOLHDR_CHAR_VAL,
  CASE
    WHEN BNK.CASH_POOLHDR_PRTCPT_VAL IS NULL
    THEN VLT.CASH_POOLHDR_PRTCPT_VAL
    ELSE BNK.CASH_POOLHDR_PRTCPT_VAL
  END AS CASH_POOLHDR_PRTCPT_VAL,
  CASE
    WHEN BNK.ACCT_TITL_NM IS NULL
    THEN VLT.ACCT_TITL_NM
    ELSE BNK.ACCT_TITL_NM
  END AS ACCT_TITL_NM,
  CASE
    WHEN BNK.FC_CODE IS NULL
    THEN VLT.FC_CODE
    ELSE BNK.FC_CODE
  END AS FC_CODE,
  --- please use the new attributes when execution already implemented on sub
  -- query
  --  CASE
  --    WHEN BNK.OVNT_SWEEP_FLAG IS NULL
  --    THEN VLT.OVNT_SWEEP_FLAG
  --    ELSE BNK.OVNT_SWEEP_FLAG
  --  END AS OVNT_SWEEP_FLAG
  CASE
    WHEN BNK.SWIFT_CODE IS NULL
    THEN VLT.SWIFT_CODE
    ELSE BNK.SWIFT_CODE
  END AS SWIFT_CODE,
  CASE
    WHEN BNK.BCD IS NULL
    THEN VLT.BCD
    ELSE BNK.BCD
  END AS BCD,
  CASE
    WHEN BNK.BR_CODE IS NULL
    THEN VLT.BR_CODE
    ELSE BNK.BR_CODE
  END AS BR_CODE,
  CASE
    WHEN BNK.SRCE_SYS_MARS_LE_CODE IS NULL
    THEN VLT.SRCE_SYS_MARS_LE_CODE
    ELSE BNK.SRCE_SYS_MARS_LE_CODE
  END AS SRCE_SYS_MARS_LE_CODE,
  CASE
    WHEN VLT.BUS_DEFN_FIELD_1 IS NULL
    THEN BNK.BUS_DEFN_FIELD_1
    ELSE VLT.BUS_DEFN_FIELD_1
  END AS BUS_DEFN_FIELD_1,
  CASE
    WHEN VLT.BUS_DEFN_FIELD_2 IS NULL
    THEN BNK.BUS_DEFN_FIELD_2
    ELSE VLT.BUS_DEFN_FIELD_2
  END AS BUS_DEFN_FIELD_2,
  CASE
    WHEN VLT.BUS_DEFN_FIELD_3 IS NULL
    THEN BNK.BUS_DEFN_FIELD_3
    ELSE VLT.BUS_DEFN_FIELD_3
  END AS BUS_DEFN_FIELD_3,
  CASE
    WHEN VLT.BUS_DEFN_FIELD_4 IS NULL
    THEN BNK.BUS_DEFN_FIELD_4
    ELSE VLT.BUS_DEFN_FIELD_4
  END AS BUS_DEFN_FIELD_4,
  CASE
    WHEN VLT.BUS_DEFN_FIELD_5 IS NULL
    THEN BNK.BUS_DEFN_FIELD_5
    ELSE VLT.BUS_DEFN_FIELD_5
  END AS BUS_DEFN_FIELD_5,
  CASE
    WHEN VLT.BUS_DEFN_FIELD_6 IS NULL
    THEN BNK.BUS_DEFN_FIELD_6
    ELSE VLT.BUS_DEFN_FIELD_6
  END AS BUS_DEFN_FIELD_6
FROM
  (
    SELECT
      ''                 AS BANK_ACCT_KEY,
      ''                 AS BANK_ACCT_ID,
      WBA.ACCTID         AS TREAS_CODE,
      WBA.ACCOUNT_NUMBER AS ACCT_NBR_TEXT,
      WBA.OPENDATE       AS ACCT_OPEN_DATE,
      WBA.CLOSEDATE      AS ACCT_CLOS_DATE,
      ''                 AS ACCT_PURP_DESC,
      WBA.ACCT_TYPE_IND  AS ACCT_TYPE_CODE,
      ''                 AS ACCT_TYPE_NM,
      WBA.CURRCODE       AS ACCT_CURR_CODE,
      ''                 AS ACCT_USED_BY_GE_FLAG,
      WBA.NAME           AS ACCT_HOLD_NM,
      WBA.IDENTITYTYPE   AS ACCT_IDNTY_TYPE_CODE,
      (
        CASE
          WHEN wba.valid=1
          THEN 'Y'
          ELSE 'N'
        END)          AS ACCT_VALID_FLAG,
      ''              AS ACCT_REF_AACCTMAP_DESC,
      AREF1.REFERENCE AS ACCT_REF_AGRADSCT_DESC,
      AREF2.REFERENCE AS ACCT_REF_ASWEEP_DESC,
      AREF3.REFERENCE AS ACCT_REF_AGLACCT_DESC,
      AREF4.REFERENCE AS ACCT_REF_AGRADSDD_DESC,
      BT.BANKTREEID   AS PARNT_BCD,
      BT.NAME         AS PARNT_BANK_NM,
      B.NAME          AS BANK_NM,
      B.BANKID        AS BANK_SHORT_NM,
      B.ADDRESS1      AS BANK_ADDR_1_TEXT,
      B.ADDRESS2      AS BANK_ADDR_2_TEXT,
      B.ADDRESS3      AS BANK_ADDR_3_TEXT,
      B.ADDRESS4      AS BANK_ADDR_4_TEXT,
      B.CITY          AS BANK_CITY_NM,
      B.STATE         AS BANK_STA_NM,
      B.POSTALCODE    AS BANK_PCDE,
      B.COUNTRY       AS BANK_CNTRY_CODE,
      B.COUNTRY       AS BANK_CNTRY_NM,
      ''              AS BANK_ACTV_FLAG,
      ''              AS BANK_DSABL_DATE,
      ''              AS PREF_BANK_FLAG,
      ''              AS ACCT_BR_SHORT_NM,
      ''              AS BR_DESC,
      ''              AS BR_ADDR_TEXT,
      ''              AS BR_CITY_NM,
      ''              AS BR_STA_NM,
      ''              AS BR_PCDE,
      ''              AS BR_CNTRY_CODE,
      ''              AS BR_ACTV_FLAG,
      ''              AS BR_DSABL_DATE,
      ''              AS MNGMT_ENT_CODE,
      ''              AS LGL_ENT_GOLD_ID_CODE,
      'WB'            AS SRCE_SYS_CODE,
      'WEBCASH'       AS SRCE_SYS_NM,
      --  (Select * from EDW.T_MD_LOAD_CNTL where SRCE_SYS_NM='EDW')
      '17-JUN-14'                      AS EFF_DATE,
      TO_DATE('1/1/9999','mm/dd/yyyy') AS EXPIRN_DATE,
      'Y'                              AS ACTV_FLAG,
      ''                               AS ACCT_MNGMT_CODE,
      ''                               AS GRND_PARNT_BUS_GRP_NAME,
      ''                               AS GRND_PARNT_BUS_GRP_CODE,
      ''                               AS GRND_PARNT_BUS_GRP_DESC,
      ''                               AS PARNT_BUS_GRP_NAME,
      ''                               AS PARNT_BUS_GRP_CODE,
      ''                               AS PARNT_BUS_GRP_DESC,
      ''                               AS BUS_GRP_NAME,
      ''                               AS BUS_GRP_CODE,
      ''                               AS BUS_GRP_DESC,
      ''                               AS BSLA_TYPE_CODE,
      ''                               AS BSLA,
      ''                               AS DR4,
      ''                               AS ACCT_STATUS_DESC,
      ''                               AS IS_CASH_POOL_FLAG,
      ''                               AS RGN_ID,
      ''                               AS INTL_ACCT_NBR,
      ''                               AS NATL_ACCT_NBR,
      ''                               AS CORP_POOLHDR_CHAR_VAL,
      ''                               AS CASH_POOLHDR_PRTCPT_VAL,
      ''                               AS ACCT_TITL_NM,
      -- New Attributes added as a part of PLC 200038 COH simplification -- by
      -- Srini 08/08/2014
      NULL AS FC_CODE,
      NULL AS BUS_DEFN_FIELD_1,
      NULL AS BUS_DEFN_FIELD_2,
      NULL AS BUS_DEFN_FIELD_3,
      NULL AS BUS_DEFN_FIELD_4,
      NULL AS BUS_DEFN_FIELD_5,
      NULL AS BUS_DEFN_FIELD_6,
      NULL AS SWIFT_CODE,
      NULL AS  BCD,
      NULL AS  BR_CODE,
      NULL AS  SRCE_SYS_MARS_LE_CODE
      --  WBA.OVNT_SWEEP_FLAG              AS OVNT_SWEEP_FLAG
    FROM
      STAGE.T_STG_WB_ACCOUNT WBA
    LEFT OUTER JOIN STAGE.T_STG_WB_ACCOUNT_REFERENCE AREF1
    ON
      WBA.ACCTINC           = AREF1.ACCTINC
    AND AREF1.REFERENCE_TYPE='AGRADSCT'
    LEFT OUTER JOIN STAGE.T_STG_WB_ACCOUNT_REFERENCE AREF2
    ON
      WBA.ACCTINC           = AREF2.ACCTINC
    AND AREF2.REFERENCE_TYPE='ASWEEP'
    LEFT OUTER JOIN STAGE.T_STG_WB_ACCOUNT_REFERENCE AREF3
    ON
      WBA.ACCTINC           = AREF3.ACCTINC
    AND AREF3.REFERENCE_TYPE='AGLACCT'
    LEFT OUTER JOIN STAGE.T_STG_WB_ACCOUNT_REFERENCE AREF4
    ON
      WBA.ACCTINC           = AREF4.ACCTINC
    AND AREF4.REFERENCE_TYPE='AGRADSDD'
    LEFT OUTER JOIN STAGE.T_STG_WB_BANK B
    ON
      B.BANKINC              =WBA.BANKINC
    AND TRUNC(B.REC_CRE_DATE)=TRUNC(WBA.REC_CRE_DATE)
    JOIN STAGE.T_STG_WB_BANK_TREE_DETAIL BTD
    ON
      BTD.INC                =B.BANKINC
    AND TRUNC(B.REC_CRE_DATE)=TRUNC(BTD.REC_CRE_DATE)
    JOIN STAGE.T_STG_WB_BANK_TREE BT
    ON
      BT.BANKTREEINC           =BTD.BANKTREEINC
    AND TRUNC(BTD.REC_CRE_DATE)=TRUNC(BT.REC_CRE_DATE)
    AND BT.BANKTREEID         <> 'BANKS'
      --where trunc(wba.rec_cre_date)='08-JUL-14'
  )
  BNK
FULL OUTER JOIN
  (
    SELECT
      ''                                       AS BANK_ACCT_KEY,
      ''                                       AS BANK_ACCT_ID,
      VNA.TREAS_CODE                           AS TREAS_CODE,
      VNA.ACCT_NBR                             AS ACCT_NBR_TEXT,
      VNA.ACCT_OPEN_DATE                       AS ACCT_OPEN_DATE,
      VNA.ACCT_CLOS_DATE                       AS ACCT_CLOS_DATE,
      LOV.OBJ_VAL                              AS ACCT_PURP_DESC,
      ''                                       AS ACCT_TYPE_CODE,
      ACT.ACCT_TYPE                            AS ACCT_TYPE_NM,
      VNA.MDM_CURR_CODE                        AS ACCT_CURR_CODE,
      DECODE(mda.GE_AUTHORITY,'YES','Y','N')   AS ACCT_USED_BY_GE_FLAG,
      VNA.ACCT_TITL                            AS ACCT_HOLD_NM,
      ''                                       AS ACCT_IDNTY_TYPE_CODE,
      ''                                       AS ACCT_VALID_FLAG,
      VNA.CASH_LANDSC_TAGGING                  AS ACCT_REF_AACCTMAP_DESC,
      ''                                       AS ACCT_REF_AGRADSCT_DESC,
      ''                                       AS ACCT_REF_ASWEEP_DESC,
      ''                                       AS ACCT_REF_AGLACCT_DESC,
      ''                                       AS ACCT_REF_AGRADSDD_DESC,
      ''                                       AS PARNT_BCD,
      ''                                       AS PARNT_BANK_NM,
      MDA.BANK_LONG_NAME                       AS BANK_NM,
      MDA.BANK_SHORT_NAME                      AS BANK_SHORT_NM,
      MDA.ADDRESS1                             AS BANK_ADDR_1_TEXT,
      MDA.ADDRESS2                             AS BANK_ADDR_2_TEXT,
      MDA.ADDRESS3                             AS BANK_ADDR_3_TEXT,
      ''                                       AS BANK_ADDR_4_TEXT,
      MDA.CITY_NAME                            AS BANK_CITY_NM,
      MDA.STATE_NAME                           AS BANK_STA_NM,
      MDA.ZIP_CODE                             AS BANK_PCDE,
      MDA.BANK_COUNTRY_CODE                    AS BANK_CNTRY_CODE,
      ''                                       AS BANK_CNTRY_NM,
      DECODE(MDA.BANK_STATUS,'Active','Y','N') AS BANK_ACTV_FLAG,
      MDA.BANK_DISABLED_DATE                   AS BANK_DSABL_DATE,
      ''                                       AS PREF_BANK_FLAG,
      BR.BANK_SHORT_NAME                       AS ACCT_BR_SHORT_NM,
      BR.BANK_LONG_NAME                        AS BR_DESC,
      BR.ADDRESS1                              AS BR_ADDR_TEXT,
      BR.CITY_NAME                             AS BR_CITY_NM,
      BR.STATE_NAME                            AS BR_STA_NM,
      BR.ZIP_CODE                              AS BR_PCDE,
      BR.BANK_COUNTRY_CODE                     AS BR_CNTRY_CODE,
      DECODE(BR.BANK_STATUS,'Active','Y','N')  AS BR_ACTV_FLAG,
      BR.BANK_DISABLED_DATE                    AS BR_DSABL_DATE,
      LMM.ME_CODE                              AS MNGMT_ENT_CODE,
      LEA.PRIMRY_ALT_CODE                      AS LGL_ENT_GOLD_ID_CODE,
      'VLT'                                    AS SRCE_SYS_CODE,
      'VAULT'                                  AS SRCE_SYS_NM,
      --    (Select * from EDW.T_MD_LOAD_CNTL where SRCE_SYS_NM='EDW')
      '17-JUN-14'                      AS EFF_DATE,
      TO_DATE('1/1/9999','mm/dd/yyyy') AS EXPIRN_DATE,
      'Y'                              AS ACTV_FLAG,
      NLOV.OBJ_VAL                     AS ACCT_MNGMT_CODE,
      GPAG.NAME                        AS GRND_PARNT_BUS_GRP_NAME,
      GPAG.CODE                        AS GRND_PARNT_BUS_GRP_CODE,
      GPAG.DESCPT                      AS GRND_PARNT_BUS_GRP_DESC,
      PAG.NAME                         AS PARNT_BUS_GRP_NAME,
      PAG.CODE                         AS PARNT_BUS_GRP_CODE,
      PAG.DESCPT                       AS PARNT_BUS_GRP_DESC,
      AG.NAME                          AS BUS_GRP_NAME,
      AG.CODE                          AS BUS_GRP_CODE,
      AG.DESCPT                        AS BUS_GRP_DESC,
      (
        CASE
          WHEN VNA.BSLA IS NOT NULL
          THEN 'GECC'
          WHEN VNA.DR4 IS NOT NULL
          THEN 'GECO'
          ELSE NULL
        END)             AS BSLA_TYPE_CODE,
      VNA.BSLA           AS BSLA,
      VNA.DR4            AS DR4,
      VNLOV.OBJ_VAL      AS ACCT_STATUS_DESC,
      VNA.IS_CASH_POOL   AS IS_CASH_POOL_FLAG,
      VNA.MDM_RGN_ID     AS RGN_ID,
      NAA.VALUE          AS INTL_ACCT_NBR,
      VNAA.VALUE         AS NATL_ACCT_NBR,
      SVNLOV.OBJ_VAL     AS CORP_POOLHDR_CHAR_VAL,
      TSVNLOV.OBJ_VAL    AS CASH_POOLHDR_PRTCPT_VAL,
      VNA.ACCT_TITL      AS ACCT_TITL_NM,
      SAI.GOLD_FUNC_CURR AS FC_CODE ,
      -- ''                 AS OVNT_SWEEP_FLAG,
      -- New Attributes added as a part of PLC 200038 COH simplification -- by
      -- Srini 08/08/2014
      mda.SWIFT_CODE,
      mda.VAULT_ID AS BCD,
      BR.VAULT_ID  AS BR_CODE,
      -----------------------------------------------------------
      LMM.MARS_LE_CODE AS SRCE_SYS_MARS_LE_CODE,
      VNA.CUST_FIELD_1 AS BUS_DEFN_FIELD_1,
      VNA.CUST_FIELD_2 AS BUS_DEFN_FIELD_2,
      VNA.CUST_FIELD_3 AS BUS_DEFN_FIELD_3,
      VNA.CUST_FIELD_4 AS BUS_DEFN_FIELD_4,
      VNA.CUST_FIELD_5 AS BUS_DEFN_FIELD_5,
      VNA.CUST_FIELD_6 AS BUS_DEFN_FIELD_6
    FROM
      STAGE.T_STG_VLT_NGB_ACCT VNA
    LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_LOV LOV
    ON
      VNA.LOV_PURPOSE_ID=LOV.LOV_ID
    AND LOV.IS_ACTV     ='Y'
    LEFT OUTER JOIN stage.T_STG_VLT_MDM_ACCT_TYPE ACT
    ON
      VNA.ACCT_TYPE_ID=ACT.ACCT_TYPE_ID
    AND ACT.STATUS    ='A'
      -------------------------------------------------------------------------
    LEFT OUTER JOIN stage.T_STG_VLT_MDM_BANK_ARCHV mda
    ON
      MDA.BANK_ID                =VNA.MDM_BANK_ID
    AND VNA.MDM_BANK_ID_EFF_DATE = MDA.ARCHIVE_RECORD_EFFECTIVE_DATE
      ----------------------------------------------------------------------------
    LEFT OUTER JOIN STAGE.T_STG_VLT_MDM_BANK_ARCHV BR
    ON
      VNA.MDM_BRANCH_ID            =br.BANK_ID
    AND VNA.MDM_BRANCH_ID_EFF_DATE = BR.ARCHIVE_RECORD_EFFECTIVE_DATE
      -----------------------------------------------------------------------------------
    LEFT OUTER JOIN stage.T_STG_VLT_MDM_LE_ME_MAP LMM
    ON
      VNA.MDM_ME_ID = LMM.ME_LE_MAP_ID
      ---------------------------------------------------------------------------------
    LEFT OUTER JOIN STAGE.T_STG_VLT_MDM_LE_ARCH LEA
    ON
      VNA.MDM_LE_ID           =LEA.PARTY_ID
    AND VNA.MDM_LE_ID_EFF_DATE=LEA.PARTY_EFF_DATE
    LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_LOV NLOV
    ON
      VNA.LOV_ACCT_MNGMT_ID =NLOV.LOV_ID
    AND NLOV.IS_ACTV        ='Y'
    LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_BUS_ACCT_GRP AG
    ON
      VNA.BUS_ACCT_GRP_ID = AG.BUS_ACCT_GRP_ID
    LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_BUS_ACCT_GRP PAG
    ON
      AG.PARENT_BG_ID=PAG.BUS_ACCT_GRP_ID
    LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_BUS_ACCT_GRP GPAG
    ON
      PAG.PARENT_BG_ID =GPAG.BUS_ACCT_GRP_ID
    LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_LOV VNLOV
    ON
      VNA.LOV_ACCT_STATUS_ID =VNLOV.LOV_ID
    AND VNLOV.IS_ACTV        ='Y'
    LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_ACCT_ALIAS NAA
    ON
      VNA.ACCT_ID=NAA.ACCT_ID
    AND NAA.TYPE ='IBAN'
    LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_ACCT_ALIAS VNAA
    ON
      VNA.ACCT_ID =VNAA.ACCT_ID
    AND VNAA.TYPE ='NBAN'
    LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_CASHPL_PRTCP_HST CPH
    ON
      VNA.ACCT_ID         =CPH.ACCT_ID
    AND VNA.EFF_START_DATE=CPH.EFF_START_DATE
    LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_LOV SVNLOV
    ON
      CPH.LOV_CORP_POOLHEADER_CHARSTC_ID =SVNLOV.LOV_ID
    AND SVNLOV.IS_ACTV                   ='Y'
    LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_LOV TSVNLOV
    ON
      CPH.LOV_CASH_POOLHEADER_PRTCP_ID =TSVNLOV.LOV_ID
    AND TSVNLOV.IS_ACTV                ='Y'
    LEFT OUTER JOIN STAGE.T_STG_VLT_MDM_STG_ACCT_INFO SAI
    ON
      VNA.ACCT_ID =SAI.ACCT_ID
      --where trunc(vna.audit_date)='08-JUL-14'
      --WHERE VNA.TREAS_CODE ='CP17'
  )
  VLT ON VLT.TREAS_CODE=BNK.TREAS_CODE
  --WHERE BNK.TREAS_CODE = '0002'

/*=====================================================================================================================================
                                        SOURCE - WEBCASH , VAULT , MDM -CHE
===================================================================================================================================== */
SELECT 
CASE
WHEN BNK.BANK_ACCT_KEY IS NULL THEN VLT.BANK_ACCT_KEY 
ELSE BNK.BANK_ACCT_KEY
END AS BANK_ACCT_KEY,
CASE
WHEN BNK.BANK_ACCT_ID IS NULL THEN VLT.BANK_ACCT_ID 
ELSE BNK.BANK_ACCT_ID
END AS BANK_ACCT_ID,
CASE
WHEN BNK.TREAS_CODE IS NULL THEN VLT.TREAS_CODE 
ELSE BNK.TREAS_CODE
END AS TREAS_CODE,
CASE
WHEN BNK.ACCT_NBR_TEXT IS NULL THEN VLT.ACCT_NBR_TEXT 
ELSE BNK.ACCT_NBR_TEXT
END AS ACCT_NBR_TEXT,
CASE
WHEN BNK.ACCT_OPEN_DATE IS NULL THEN VLT.ACCT_OPEN_DATE 
ELSE BNK.ACCT_OPEN_DATE
END AS ACCT_OPEN_DATE,
CASE
WHEN BNK.ACCT_CLOS_DATE IS NULL THEN VLT.ACCT_CLOS_DATE 
ELSE BNK.ACCT_CLOS_DATE
END AS ACCT_CLOS_DATE,
CASE
WHEN BNK.ACCT_PURP_DESC IS NULL THEN VLT.ACCT_PURP_DESC 
ELSE BNK.ACCT_PURP_DESC
END AS ACCT_PURP_DESC,
CASE
WHEN BNK.ACCT_TYPE_CODE IS NULL THEN VLT.ACCT_TYPE_CODE 
ELSE BNK.ACCT_TYPE_CODE
END AS ACCT_TYPE_CODE,
CASE
WHEN BNK.ACCT_TYPE_NM IS NULL THEN VLT.ACCT_TYPE_NM 
ELSE BNK.ACCT_TYPE_NM
END AS ACCT_TYPE_NM,
CASE
WHEN BNK.ACCT_CURR_CODE IS NULL THEN VLT.ACCT_CURR_CODE 
ELSE BNK.ACCT_CURR_CODE
END AS ACCT_CURR_CODE,
CASE
WHEN BNK.ACCT_USED_BY_GE_FLAG IS NULL THEN VLT.ACCT_USED_BY_GE_FLAG 
ELSE BNK.ACCT_USED_BY_GE_FLAG
END AS ACCT_USED_BY_GE_FLAG,
CASE
WHEN BNK.ACCT_HOLD_NM IS NULL THEN VLT.ACCT_HOLD_NM 
ELSE BNK.ACCT_HOLD_NM
END AS ACCT_HOLD_NM,
CASE
WHEN BNK.ACCT_IDNTY_TYPE_CODE IS NULL THEN VLT.ACCT_IDNTY_TYPE_CODE 
ELSE BNK.ACCT_IDNTY_TYPE_CODE
END AS ACCT_IDNTY_TYPE_CODE,
CASE
WHEN BNK.ACCT_VALID_FLAG IS NULL THEN VLT.ACCT_VALID_FLAG 
ELSE BNK.ACCT_VALID_FLAG
END AS ACCT_VALID_FLAG,
CASE
WHEN BNK.ACCT_REF_AACCTMAP_DESC IS NULL THEN VLT.ACCT_REF_AACCTMAP_DESC 
ELSE BNK.ACCT_REF_AACCTMAP_DESC
END AS ACCT_REF_AACCTMAP_DESC,
CASE
WHEN BNK.ACCT_REF_AGRADSCT_DESC IS NULL THEN VLT.ACCT_REF_AGRADSCT_DESC 
ELSE BNK.ACCT_REF_AGRADSCT_DESC
END AS ACCT_REF_AGRADSCT_DESC,
CASE
WHEN BNK.ACCT_REF_ASWEEP_DESC IS NULL THEN VLT.ACCT_REF_ASWEEP_DESC 
ELSE BNK.ACCT_REF_ASWEEP_DESC
END AS ACCT_REF_ASWEEP_DESC,
CASE
WHEN BNK.ACCT_REF_AGLACCT_DESC IS NULL THEN VLT.ACCT_REF_AGLACCT_DESC 
ELSE BNK.ACCT_REF_AGLACCT_DESC
END AS ACCT_REF_AGLACCT_DESC,
CASE
WHEN BNK.ACCT_REF_AGRADSDD_DESC IS NULL THEN VLT.ACCT_REF_AGRADSDD_DESC 
ELSE BNK.ACCT_REF_AGRADSDD_DESC
END AS ACCT_REF_AGRADSDD_DESC,
CASE
WHEN BNK.PARNT_BCD IS NULL THEN VLT.PARNT_BCD 
ELSE BNK.PARNT_BCD
END AS PARNT_BCD,
CASE
WHEN BNK.PARNT_BANK_NM IS NULL THEN VLT.PARNT_BANK_NM 
ELSE BNK.PARNT_BANK_NM
END AS PARNT_BANK_NM,
CASE
WHEN BNK.BANK_NM IS NULL THEN VLT.BANK_NM 
ELSE BNK.BANK_NM
END AS BANK_NM,
CASE
WHEN BNK.BANK_SHORT_NM IS NULL THEN VLT.BANK_SHORT_NM 
ELSE BNK.BANK_SHORT_NM
END AS BANK_SHORT_NM,
CASE
WHEN BNK.BANK_ADDR_1_TEXT IS NULL THEN VLT.BANK_ADDR_1_TEXT 
ELSE BNK.BANK_ADDR_1_TEXT
END AS BANK_ADDR_1_TEXT,
CASE
WHEN BNK.BANK_ADDR_2_TEXT IS NULL THEN VLT.BANK_ADDR_2_TEXT 
ELSE BNK.BANK_ADDR_2_TEXT
END AS BANK_ADDR_2_TEXT,
CASE
WHEN BNK.BANK_ADDR_3_TEXT IS NULL THEN VLT.BANK_ADDR_3_TEXT 
ELSE BNK.BANK_ADDR_3_TEXT
END AS BANK_ADDR_3_TEXT,
CASE
WHEN BNK.BANK_ADDR_4_TEXT IS NULL THEN VLT.BANK_ADDR_4_TEXT 
ELSE BNK.BANK_ADDR_4_TEXT
END AS BANK_ADDR_4_TEXT,
CASE
WHEN BNK.BANK_CITY_NM IS NULL THEN VLT.BANK_CITY_NM 
ELSE BNK.BANK_CITY_NM
END AS BANK_CITY_NM,
CASE
WHEN BNK.BANK_STA_NM IS NULL THEN VLT.BANK_STA_NM 
ELSE BNK.BANK_STA_NM
END AS BANK_STA_NM,
CASE
WHEN BNK.BANK_PCDE IS NULL THEN VLT.BANK_PCDE 
ELSE BNK.BANK_PCDE
END AS BANK_PCDE,
CASE
WHEN BNK.BANK_CNTRY_CODE IS NULL THEN VLT.BANK_CNTRY_CODE 
ELSE BNK.BANK_CNTRY_CODE
END AS BANK_CNTRY_CODE,
CASE
WHEN BNK.BANK_CNTRY_NM IS NULL THEN VLT.BANK_CNTRY_NM 
ELSE BNK.BANK_CNTRY_NM
END AS BANK_CNTRY_NM,
CASE
WHEN BNK.BANK_ACTV_FLAG IS NULL THEN VLT.BANK_ACTV_FLAG 
ELSE BNK.BANK_ACTV_FLAG
END AS BANK_ACTV_FLAG,
--CASE
--WHEN BNK.BANK_DSABL_DATE IS NULL THEN VLT.BANK_DSABL_DATE 
--ELSE BNK.BANK_DSABL_DATE
--END AS BANK_DSABL_DATE,
CASE
WHEN BNK.PREF_BANK_FLAG IS NULL THEN VLT.PREF_BANK_FLAG 
ELSE BNK.PREF_BANK_FLAG
END AS PREF_BANK_FLAG,
CASE
WHEN BNK.ACCT_BR_SHORT_NM IS NULL THEN VLT.ACCT_BR_SHORT_NM 
ELSE BNK.ACCT_BR_SHORT_NM
END AS ACCT_BR_SHORT_NM,
CASE
WHEN BNK.BR_DESC IS NULL THEN VLT.BR_DESC 
ELSE BNK.BR_DESC
END AS BR_DESC,
CASE
WHEN BNK.BR_ADDR_TEXT IS NULL THEN VLT.BR_ADDR_TEXT 
ELSE BNK.BR_ADDR_TEXT
END AS BR_ADDR_TEXT,
CASE
WHEN BNK.BR_CITY_NM IS NULL THEN VLT.BR_CITY_NM 
ELSE BNK.BR_CITY_NM
END AS BR_CITY_NM,
CASE
WHEN BNK.BR_STA_NM IS NULL THEN VLT.BR_STA_NM 
ELSE BNK.BR_STA_NM
END AS BR_STA_NM,
CASE
WHEN BNK.BR_PCDE IS NULL THEN VLT.BR_PCDE 
ELSE BNK.BR_PCDE
END AS BR_PCDE,
CASE
WHEN BNK.BR_CNTRY_CODE IS NULL THEN VLT.BR_CNTRY_CODE 
ELSE BNK.BR_CNTRY_CODE
END AS BR_CNTRY_CODE,
CASE
WHEN BNK.BR_ACTV_FLAG IS NULL THEN VLT.BR_ACTV_FLAG 
ELSE BNK.BR_ACTV_FLAG
END AS BR_ACTV_FLAG,
--CASE
--WHEN BNK.BR_DSABL_DATE IS NULL THEN VLT.BR_DSABL_DATE 
--ELSE BNK.BR_DSABL_DATE
--END AS BR_DSABL_DATE,
CASE
WHEN BNK.MNGMT_ENT_CODE IS NULL THEN VLT.MNGMT_ENT_CODE 
ELSE BNK.MNGMT_ENT_CODE
END AS MNGMT_ENT_CODE,
CASE
WHEN BNK.LGL_ENT_GOLD_ID_CODE IS NULL THEN VLT.LGL_ENT_GOLD_ID_CODE 
ELSE BNK.LGL_ENT_GOLD_ID_CODE
END AS LGL_ENT_GOLD_ID_CODE,
CASE
WHEN BNK.SRCE_SYS_CODE IS NOT NULL AND VLT.SRCE_SYS_CODE  IS NOT NULL THEN 'WB_VLT'
WHEN BNK.SRCE_SYS_CODE IS NULL THEN VLT.SRCE_SYS_CODE 
WHEN VLT.SRCE_SYS_CODE IS NULL THEN BNK.SRCE_SYS_CODE
END AS SRCE_SYS_CODE,
CASE
WHEN BNK.SRCE_SYS_NM IS NOT NULL AND VLT.SRCE_SYS_NM  IS NOT NULL THEN 'WB_VLT'
WHEN BNK.SRCE_SYS_NM IS NULL THEN VLT.SRCE_SYS_NM 
WHEN VLT.SRCE_SYS_NM IS NULL THEN BNK.SRCE_SYS_NM
END AS SRCE_SYS_NM,
CASE
WHEN BNK.EFF_DATE IS NULL THEN VLT.EFF_DATE 
ELSE BNK.EFF_DATE
END AS EFF_DATE,
CASE
WHEN BNK.EXPIRN_DATE IS NULL THEN VLT.EXPIRN_DATE 
ELSE BNK.EXPIRN_DATE
END AS EXPIRN_DATE,
CASE
WHEN BNK.ACTV_FLAG IS NULL THEN VLT.ACTV_FLAG 
ELSE BNK.ACTV_FLAG
END AS ACTV_FLAG,
CASE
WHEN BNK.ACCT_MNGMT_CODE IS NULL THEN VLT.ACCT_MNGMT_CODE 
ELSE BNK.ACCT_MNGMT_CODE
END AS ACCT_MNGMT_CODE,
CASE
WHEN BNK.GRND_PARNT_BUS_GRP_NAME IS NULL THEN VLT.GRND_PARNT_BUS_GRP_NAME 
ELSE BNK.GRND_PARNT_BUS_GRP_NAME
END AS GRND_PARNT_BUS_GRP_NAME,
CASE
WHEN BNK.GRND_PARNT_BUS_GRP_CODE IS NULL THEN VLT.GRND_PARNT_BUS_GRP_CODE 
ELSE BNK.GRND_PARNT_BUS_GRP_CODE
END AS GRND_PARNT_BUS_GRP_CODE,
CASE
WHEN BNK.GRND_PARNT_BUS_GRP_DESC IS NULL THEN VLT.GRND_PARNT_BUS_GRP_DESC 
ELSE BNK.GRND_PARNT_BUS_GRP_DESC
END AS GRND_PARNT_BUS_GRP_DESC,
CASE
WHEN BNK.PARNT_BUS_GRP_NAME IS NULL THEN VLT.PARNT_BUS_GRP_NAME 
ELSE BNK.PARNT_BUS_GRP_NAME
END AS PARNT_BUS_GRP_NAME,
CASE
WHEN BNK.PARNT_BUS_GRP_CODE IS NULL THEN VLT.PARNT_BUS_GRP_CODE 
ELSE BNK.PARNT_BUS_GRP_CODE
END AS PARNT_BUS_GRP_CODE,
CASE
WHEN BNK.PARNT_BUS_GRP_DESC IS NULL THEN VLT.PARNT_BUS_GRP_DESC 
ELSE BNK.PARNT_BUS_GRP_DESC
END AS PARNT_BUS_GRP_DESC,
CASE
WHEN BNK.BUS_GRP_NAME IS NULL THEN VLT.BUS_GRP_NAME 
ELSE BNK.BUS_GRP_NAME
END AS BUS_GRP_NAME,
CASE
WHEN BNK.BUS_GRP_CODE IS NULL THEN VLT.BUS_GRP_CODE 
ELSE BNK.BUS_GRP_CODE
END AS BUS_GRP_CODE,
CASE
WHEN BNK.BUS_GRP_DESC IS NULL THEN VLT.BUS_GRP_DESC 
ELSE BNK.BUS_GRP_DESC
END AS BUS_GRP_DESC,
CASE
WHEN BNK.BSLA_TYPE_CODE IS NULL THEN VLT.BSLA_TYPE_CODE 
ELSE BNK.BSLA_TYPE_CODE
END AS BSLA_TYPE_CODE,
CASE
WHEN BNK.BSLA IS NULL THEN VLT.BSLA 
ELSE BNK.BSLA
END AS BSLA,
CASE
WHEN BNK.DR4 IS NULL THEN VLT.DR4 
ELSE BNK.DR4
END AS DR4,
CASE
WHEN BNK.ACCT_STATUS_DESC IS NULL THEN VLT.ACCT_STATUS_DESC 
ELSE BNK.ACCT_STATUS_DESC
END AS ACCT_STATUS_DESC,
CASE
WHEN BNK.IS_CASH_POOL_FLAG IS NULL THEN VLT.IS_CASH_POOL_FLAG 
ELSE BNK.IS_CASH_POOL_FLAG
END AS IS_CASH_POOL_FLAG,
CASE
WHEN BNK.RGN_ID IS NULL THEN VLT.RGN_ID 
ELSE BNK.RGN_ID
END AS RGN_ID,
CASE
WHEN BNK.INTL_ACCT_NBR IS NULL THEN VLT.INTL_ACCT_NBR 
ELSE BNK.INTL_ACCT_NBR
END AS INTL_ACCT_NBR,
CASE
WHEN BNK.NATL_ACCT_NBR IS NULL THEN VLT.NATL_ACCT_NBR 
ELSE BNK.NATL_ACCT_NBR
END AS NATL_ACCT_NBR,
CASE
WHEN BNK.CORP_POOLHDR_CHAR_VAL IS NULL THEN VLT.CORP_POOLHDR_CHAR_VAL 
ELSE BNK.CORP_POOLHDR_CHAR_VAL
END AS CORP_POOLHDR_CHAR_VAL,
CASE
WHEN BNK.CASH_POOLHDR_PRTCPT_VAL IS NULL THEN VLT.CASH_POOLHDR_PRTCPT_VAL 
ELSE BNK.CASH_POOLHDR_PRTCPT_VAL
END AS CASH_POOLHDR_PRTCPT_VAL,
CASE
WHEN BNK.ACCT_TITL_NM IS NULL THEN VLT.ACCT_TITL_NM 
ELSE BNK.ACCT_TITL_NM
END AS ACCT_TITL_NM,
CASE
WHEN BNK.FC_CODE IS NULL THEN VLT.FC_CODE 
ELSE BNK.FC_CODE
END AS FC_CODE,
CASE
WHEN BNK.OVNT_SWEEP_FLAG IS NULL THEN VLT.OVNT_SWEEP_FLAG 
ELSE BNK.OVNT_SWEEP_FLAG
END AS OVNT_SWEEP_FLAG



FROM (
SELECT 
''            AS BANK_ACCT_KEY,
  ''                 AS BANK_ACCT_ID,
  WBA.ACCTID         AS TREAS_CODE,
  WBA.ACCOUNT_NUMBER AS ACCT_NBR_TEXT,
  WBA.OPENDATE       AS ACCT_OPEN_DATE,
  WBA.CLOSEDATE      AS ACCT_CLOS_DATE,
  ''                 AS ACCT_PURP_DESC,
  WBA.ACCT_TYPE_IND  AS ACCT_TYPE_CODE,
  ''                 AS ACCT_TYPE_NM,
  WBA.CURRCODE       AS ACCT_CURR_CODE,
  ''                 AS ACCT_USED_BY_GE_FLAG,
  WBA.NAME           AS ACCT_HOLD_NM,
  WBA.IDENTITYTYPE   AS ACCT_IDNTY_TYPE_CODE,
  (
  CASE
    WHEN wba.valid=1
    THEN 'Y'
    ELSE 'N'
  END)            AS ACCT_VALID_FLAG,
  ''              AS ACCT_REF_AACCTMAP_DESC,
  AREF1.REFERENCE AS ACCT_REF_AGRADSCT_DESC,
  AREF2.REFERENCE AS ACCT_REF_ASWEEP_DESC,
  AREF3.REFERENCE AS ACCT_REF_AGLACCT_DESC,
  AREF4.REFERENCE AS ACCT_REF_AGRADSDD_DESC,
  BT.BANKTREEID   AS PARNT_BCD,
  BT.NAME         AS PARNT_BANK_NM,
  B.NAME          AS BANK_NM,
  B.BANKID        AS BANK_SHORT_NM,
  B.ADDRESS1    AS BANK_ADDR_1_TEXT,
  B.ADDRESS2    AS BANK_ADDR_2_TEXT,
  B.ADDRESS3    AS BANK_ADDR_3_TEXT,
  B.ADDRESS4    AS BANK_ADDR_4_TEXT,
  B.CITY        AS BANK_CITY_NM,
  B.STATE       AS BANK_STA_NM,
  B.POSTALCODE  AS BANK_PCDE,
  B.COUNTRY     AS BANK_CNTRY_CODE,
  B.COUNTRY     AS BANK_CNTRY_NM,
  ''              AS BANK_ACTV_FLAG,
  ''              AS BANK_DSABL_DATE,
  ''              AS PREF_BANK_FLAG,
  ''              AS ACCT_BR_SHORT_NM,
  ''              AS BR_DESC,
  ''              AS BR_ADDR_TEXT,
  ''              AS BR_CITY_NM,
  ''              AS BR_STA_NM,
  ''              AS BR_PCDE,
  ''              AS BR_CNTRY_CODE,
  ''              AS BR_ACTV_FLAG,
  ''              AS BR_DSABL_DATE,
  ''              AS MNGMT_ENT_CODE,
  ''              AS LGL_ENT_GOLD_ID_CODE,
  'WB'            AS SRCE_SYS_CODE,
  'WEBCASH'       AS SRCE_SYS_NM,
  --  (Select * from EDW.T_MD_LOAD_CNTL where SRCE_SYS_NM='EDW')
  '17-JUN-14'                      AS EFF_DATE,
  TO_DATE('1/1/9999','mm/dd/yyyy') AS EXPIRN_DATE,
  'Y'                              AS ACTV_FLAG,
  ''                               AS ACCT_MNGMT_CODE,
  ''                               AS GRND_PARNT_BUS_GRP_NAME,
  ''                               AS GRND_PARNT_BUS_GRP_CODE,
  ''                               AS GRND_PARNT_BUS_GRP_DESC,
  ''                               AS PARNT_BUS_GRP_NAME,
  ''                               AS PARNT_BUS_GRP_CODE,
  ''                               AS PARNT_BUS_GRP_DESC,
  ''                               AS BUS_GRP_NAME,
  ''                               AS BUS_GRP_CODE,
  ''                               AS BUS_GRP_DESC,
  ''                               AS BSLA_TYPE_CODE,
  ''                               AS BSLA,
  ''                               AS DR4,
  ''                               AS ACCT_STATUS_DESC,
  ''                               AS IS_CASH_POOL_FLAG,
  ''                               AS RGN_ID,
  ''                               AS INTL_ACCT_NBR,
  ''                               AS NATL_ACCT_NBR,
  ''                               AS CORP_POOLHDR_CHAR_VAL,
  ''                               AS CASH_POOLHDR_PRTCPT_VAL,
  ''                               AS ACCT_TITL_NM,
  ''                               AS FC_CODE,
  WBA.OVNT_SWEEP_FLAG              AS OVNT_SWEEP_FLAG
FROM STAGE.T_STG_WB_ACCOUNT WBA
LEFT OUTER JOIN STAGE.T_STG_WB_ACCOUNT_REFERENCE AREF1
ON WBA.ACCTINC          = AREF1.ACCTINC
AND AREF1.REFERENCE_TYPE='AGRADSCT'
LEFT OUTER JOIN STAGE.T_STG_WB_ACCOUNT_REFERENCE AREF2
ON WBA.ACCTINC          = AREF2.ACCTINC
AND AREF2.REFERENCE_TYPE='ASWEEP'
LEFT OUTER JOIN STAGE.T_STG_WB_ACCOUNT_REFERENCE AREF3
ON WBA.ACCTINC          = AREF3.ACCTINC
AND AREF3.REFERENCE_TYPE='AGLACCT'
LEFT OUTER JOIN STAGE.T_STG_WB_ACCOUNT_REFERENCE AREF4
ON WBA.ACCTINC          = AREF4.ACCTINC
AND AREF4.REFERENCE_TYPE='AGRADSDD'
LEFT OUTER JOIN STAGE.T_STG_WB_BANK B
ON B.BANKINC             =WBA.BANKINC
AND TRUNC(B.REC_CRE_DATE)=TRUNC(WBA.REC_CRE_DATE)
JOIN STAGE.T_STG_WB_BANK_TREE_DETAIL BTD
ON BTD.INC               =B.BANKINC
AND TRUNC(B.REC_CRE_DATE)=TRUNC(BTD.REC_CRE_DATE)
JOIN STAGE.T_STG_WB_BANK_TREE BT
ON BT.BANKTREEINC          =BTD.BANKTREEINC
AND TRUNC(BTD.REC_CRE_DATE)=TRUNC(BT.REC_CRE_DATE)
AND BT.BANKTREEID         <> 'BANKS'
--where trunc(wba.rec_cre_date)='08-JUL-14'
)BNK
full outer join
(SELECT ''                                  AS BANK_ACCT_KEY,
  ''                                       AS BANK_ACCT_ID,
  VNA.TREAS_CODE                           AS TREAS_CODE,
  VNA.ACCT_NBR                             AS ACCT_NBR_TEXT,
  VNA.ACCT_OPEN_DATE                       AS ACCT_OPEN_DATE,
  VNA.ACCT_CLOS_DATE                       AS ACCT_CLOS_DATE,
  LOV.OBJ_VAL                              AS ACCT_PURP_DESC,
  ''                                       AS ACCT_TYPE_CODE,
  ACT.ACCT_TYPE                            AS ACCT_TYPE_NM,
  VNA.MDM_CURR_CODE                        AS ACCT_CURR_CODE,
  DECODE(mda.GE_AUTHORITY,'YES','Y','N')   AS ACCT_USED_BY_GE_FLAG,
  VNA.ACCT_TITL                            AS ACCT_HOLD_NM,
  ''                                       AS ACCT_IDNTY_TYPE_CODE,
  ''                                       AS ACCT_VALID_FLAG,
  VNA.CASH_LANDSC_TAGGING                  AS ACCT_REF_AACCTMAP_DESC,
  ''                                       AS ACCT_REF_AGRADSCT_DESC,
  ''                                       AS ACCT_REF_ASWEEP_DESC,
  ''                                       AS ACCT_REF_AGLACCT_DESC,
  ''                                       AS ACCT_REF_AGRADSDD_DESC,
  ''                                       AS PARNT_BCD,
  ''                                       AS PARNT_BANK_NM,
  MDA.BANK_LONG_NAME                       AS BANK_NM,
  MDA.BANK_SHORT_NAME                      AS BANK_SHORT_NM,
  MDA.ADDRESS1                             AS BANK_ADDR_1_TEXT,
  MDA.ADDRESS2                             AS BANK_ADDR_2_TEXT,
  MDA.ADDRESS3                             AS BANK_ADDR_3_TEXT,
  ''                                       AS BANK_ADDR_4_TEXT,
  MDA.CITY_NAME                            AS BANK_CITY_NM,
  MDA.STATE_NAME                           AS BANK_STA_NM,
  MDA.ZIP_CODE                             AS BANK_PCDE,
  MDA.BANK_COUNTRY_CODE                    AS BANK_CNTRY_CODE,
  ''                                       AS BANK_CNTRY_NM,
  DECODE(MDA.BANK_STATUS,'Active','Y','N') AS BANK_ACTV_FLAG,
  MDA.BANK_DISABLED_DATE                   AS BANK_DSABL_DATE,
  ''                                       AS PREF_BANK_FLAG,
  BR.BANK_SHORT_NAME                       AS ACCT_BR_SHORT_NM,
  BR.BANK_LONG_NAME                        AS BR_DESC,
  BR.ADDRESS1                              AS BR_ADDR_TEXT,
  BR.CITY_NAME                             AS BR_CITY_NM,
  BR.STATE_NAME                            AS BR_STA_NM,
  BR.ZIP_CODE                              AS BR_PCDE,
  BR.BANK_COUNTRY_CODE                     AS BR_CNTRY_CODE,
  DECODE(BR.BANK_STATUS,'Active','Y','N')  AS BR_ACTV_FLAG,
  BR.BANK_DISABLED_DATE                    AS BR_DSABL_DATE,
  LMM.ME_CODE                              AS MNGMT_ENT_CODE,
  LEA.PRIMRY_ALT_CODE                      AS LGL_ENT_GOLD_ID_CODE,
  'VLT'                                    AS SRCE_SYS_CODE,
  'VAULT'                                  AS SRCE_SYS_NM,
--    (Select * from EDW.T_MD_LOAD_CNTL where SRCE_SYS_NM='EDW')
  '17-JUN-14'                      AS EFF_DATE,
  TO_DATE('1/1/9999','mm/dd/yyyy') AS EXPIRN_DATE,
  'Y'                              AS ACTV_FLAG,
  NLOV.OBJ_VAL                     AS ACCT_MNGMT_CODE,
  GPAG.NAME                        AS GRND_PARNT_BUS_GRP_NAME,
  GPAG.CODE                        AS GRND_PARNT_BUS_GRP_CODE,
  GPAG.DESCPT                      AS GRND_PARNT_BUS_GRP_DESC,
  PAG.NAME                         AS PARNT_BUS_GRP_NAME,
  PAG.CODE                         AS PARNT_BUS_GRP_CODE,
  PAG.DESCPT                       AS PARNT_BUS_GRP_DESC,
  AG.NAME                          AS BUS_GRP_NAME,
  AG.CODE                          AS BUS_GRP_CODE,
  AG.DESCPT                        AS BUS_GRP_DESC,
  (
  CASE
    WHEN VNA.BSLA IS NOT NULL
    THEN 'GECC'
    WHEN VNA.DR4 IS NOT NULL
    THEN 'GECO'
    ELSE NULL
  END)               AS BSLA_TYPE_CODE,
  VNA.BSLA           AS BSLA,
  VNA.DR4            AS DR4,
  VNLOV.OBJ_VAL      AS ACCT_STATUS_DESC,
  VNA.IS_CASH_POOL   AS IS_CASH_POOL_FLAG,
  VNA.MDM_RGN_ID     AS RGN_ID,
  NAA.VALUE          AS INTL_ACCT_NBR,
  VNAA.VALUE         AS NATL_ACCT_NBR,
  SVNLOV.OBJ_VAL     AS CORP_POOLHDR_CHAR_VAL,
  TSVNLOV.OBJ_VAL    AS CASH_POOLHDR_PRTCPT_VAL,
  VNA.ACCT_TITL      AS ACCT_TITL_NM,
  SAI.GOLD_FUNC_CURR AS FC_CODE
  ,''                 AS OVNT_SWEEP_FLAG,
  mda.SWIFT_CODE,
  mda.VAULT_ID as BCD,
  BR.VAULT_ID as BR_CODE,
FROM STAGE.T_STG_VLT_NGB_ACCT VNA
LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_LOV LOV
ON VNA.LOV_PURPOSE_ID=LOV.LOV_ID
AND LOV.IS_ACTV      ='Y'
LEFT OUTER JOIN stage.T_STG_VLT_MDM_ACCT_TYPE ACT
ON VNA.ACCT_TYPE_ID=ACT.ACCT_TYPE_ID
AND ACT.STATUS     ='A'
-------------------------------------------------------------------------
LEFT OUTER JOIN stage.T_STG_VLT_MDM_BANK_ARCHV mda
ON MDA.BANK_ID               =VNA.MDM_BANK_ID
AND VNA.MDM_BANK_ID_EFF_DATE = MDA.ARCHIVE_RECORD_EFFECTIVE_DATE
----------------------------------------------------------------------------
LEFT OUTER JOIN STAGE.T_STG_VLT_MDM_BANK_ARCHV BR
ON VNA.MDM_BRANCH_ID           =br.BANK_ID
AND VNA.MDM_BRANCH_ID_EFF_DATE = BR.ARCHIVE_RECORD_EFFECTIVE_DATE
-----------------------------------------------------------------------------------
LEFT OUTER JOIN stage.T_STG_VLT_MDM_LE_ME_MAP LMM
ON VNA.MDM_ME_ID =ME_LE_MAP_ID
LEFT OUTER JOIN STAGE.T_STG_VLT_MDM_LE_ARCH LEA
ON VNA.MDM_LE_ID          =LEA.PARTY_ID
AND VNA.MDM_LE_ID_EFF_DATE=LEA.PARTY_EFF_DATE
LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_LOV NLOV
ON VNA.LOV_ACCT_MNGMT_ID =NLOV.LOV_ID
AND NLOV.IS_ACTV         ='Y'
LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_BUS_ACCT_GRP AG
ON VNA.BUS_ACCT_GRP_ID = AG.BUS_ACCT_GRP_ID
LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_BUS_ACCT_GRP PAG
ON AG.PARENT_BG_ID=PAG.BUS_ACCT_GRP_ID
LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_BUS_ACCT_GRP GPAG
ON PAG.PARENT_BG_ID =GPAG.BUS_ACCT_GRP_ID
LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_LOV VNLOV
ON VNA.LOV_ACCT_STATUS_ID =VNLOV.LOV_ID
AND VNLOV.IS_ACTV         ='Y'
LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_ACCT_ALIAS NAA
ON VNA.ACCT_ID=NAA.ACCT_ID
AND NAA.TYPE  ='IBAN'
LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_ACCT_ALIAS VNAA
ON VNA.ACCT_ID=VNAA.ACCT_ID
AND VNAA.TYPE ='NBAN'
LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_CASHPL_PRTCP_HST CPH
ON VNA.ACCT_ID        =CPH.ACCT_ID
AND VNA.EFF_START_DATE=CPH.EFF_START_DATE
LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_LOV SVNLOV
ON CPH.LOV_CORP_POOLHEADER_CHARSTC_ID =SVNLOV.LOV_ID
AND SVNLOV.IS_ACTV                    ='Y'
LEFT OUTER JOIN STAGE.T_STG_VLT_NGB_LOV TSVNLOV
ON CPH.LOV_CASH_POOLHEADER_PRTCP_ID =TSVNLOV.LOV_ID
AND TSVNLOV.IS_ACTV                 ='Y'
LEFT OUTER JOIN STAGE.T_STG_VLT_MDM_STG_ACCT_INFO SAI
ON VNA.ACCT_ID       =SAI.ACCT_ID
--where trunc(vna.audit_date)='08-JUL-14'
--WHERE VNA.TREAS_CODE ='CP17'
)VLT
ON VLT.TREAS_CODE=BNK.TREAS_CODE
--WHERE BNK.TREAS_CODE = '0002'

/*=====================================================================================================================================
                                        SOURCE - WEBCASH , VAULT , MDM -CHE
===================================================================================================================================== */
SELECT DISTINCT
T_STG_VLT_NGB_ACCT.ACCT_NBR AS ACCT_NBR_TEXT,
T_STG_VLT_NGB_ACCT.TREAS_CODE AS TREAS_CODE ,
T_STG_VLT_NGB_ACCT.ACCT_TITL AS ACCT_TITL_NM,
T_STG_VLT_NGB_ACCT.ACCT_OPEN_DATE AS BANK_ACCT_OPEN_DATE,
T_STG_VLT_NGB_ACCT.ACCT_CLOS_DATE AS BANK_ACCT_CLOS_DATE,
T_STG_VLT_MDM_ACCT_TYPE.ACCT_TYPE AS ACCT_TYPE_NM,
T_STG_VLT_NGB_ACCT.LOV_PURPOSE_ID AS LOV_PURPOSE_ID,
T_STG_VLT_NGB_ACCT.LOV_ACCT_MNGMT_ID AS LOV_ACCT_MGNMT_ID,
T_STG_VLT_MDM_LE_ARCH.PRIMRY_ALT_CODE AS VLT_LGL_ENT_CODE,
T_STG_VLT_MDM_LE_ARCH.PARTY_LONG_NM AS LGL_ENT_NM,
T_STG_VLT_NGB_ACCT.DR4 AS DR4,
T_STG_VLT_NGB_ACCT.BSLA AS BSLA,
T_STG_VLT_NGB_ACCT.MDM_CURR_CODE AS VLT_CURR_CODE,
T_STG_VLT_NGB_ACCT.LOV_ACCT_STATUS_ID as LOV_ACCT_STATUS_ID,
BNK.BANK_LONG_NAME as BANK_NM,
BNK.BANK_SHORT_NAME as ACCT_BANK_SHORT_NM,
BNK.BANK_STATUS as BANK_STATUS,
BNK.BANK_DISABLED_DATE as BANK_DSABL_DATE,
BNK.GE_AUTHORITY as GE_AUTHORITY,
BNK.ADDRESS1 as BANK_ADDR_TEXT,
BNK.ADDRESS2 as BANK_LOC_NM,
BNK.CITY_NAME as BANK_CITY_NM,
BNK.STATE_NAME as BANK_STA_NM,
BNK.BANK_COUNTRY_CODE as BANK_CNTRY_CODE,
BNK.ZIP_CODE as BANK_ZIP_CODE,
BR.BANK_LONG_NAME as BANK_BR_DESC,
BR.BANK_SHORT_NAME as ACCT_BR_SHORT_NM,
BR.BANK_STATUS as BR_STATUS,
BR.BANK_DISABLED_DATE as BR_DSABL_DATE,
BR.ADDRESS1 as BR_ADDR,
BR.ADDRESS2 as BR_LOC_NM,
BR.CITY_NAME as BR_CITY_NM,
BR.STATE_NAME as BR_STA_NM,
BR.BANK_COUNTRY_CODE as BR_CNTRY_CODE,
BR.ZIP_CODE AS BR_ZIP_CODE,
(CASE WHEN T_STG_VLT_NGB_ACCT.BSLA IS NOT NULL THEN 'GECC'
     WHEN T_STG_VLT_NGB_ACCT.DR4 IS NOT NULL THEN 'GECO'
     ELSE NULL
  END) as BSLA_TYPE_CODE,
AG.NAME as BUS_GRP_NAME,
AG.CODE as BUS_GRP_CODE,
AG.DESCPT as BUS_GRP_DESC,
PAG.NAME as PARNT_BUS_GRP_NAME,
PAG.CODE as PARNT_BUS_GRP_CODE,
PAG.DESCPT as PARNT_BUS_GRP_DESC,
GPAG.NAME as GRND_PARNT_BUS_GRP_NAME,
GPAG.CODE as GRND_PARNT_BUS_GRP_CODE,
GPAG.DESCPT as GRND_PARNT_BUS_GRP_DESC,
T_STG_VLT_MDM_LE_ME_MAP.ME_CODE AS VLT_MNGMT_ENT_CODE,
T_STG_VLT_NGB_ACCT.IS_CASH_POOL AS IS_CASH_POOL_FLAG,
T_STG_VLT_NGB_ACCT.MDM_RGN_ID AS MDM_RGN_ID,
T_STG_VLT_NGB_ACCT.ACCT_ID AS ACCT_ID,
T_STG_VLT_NGB_CASHPL_PRTCP_HST.LOV_CORP_POOLHEADER_CHARSTC_ID,
T_STG_VLT_NGB_CASHPL_PRTCP_HST.LOV_CASH_POOLHEADER_PRTCP_ID,
T_STG_VLT_NGB_ACCT.CASH_LANDSC_TAGGING,
BNK.SWIFT_CODE,
BNK.VAULT_ID BCD,
BR.VAULT_ID BR_CODE,
T_STG_VLT_MDM_LE_ME_MAP.MARS_LE_CODE SRCE_SYS_MARS_LE_CODE,
T_STG_VLT_NGB_ACCT.CUST_FIELD_1,
T_STG_VLT_NGB_ACCT.CUST_FIELD_2,
T_STG_VLT_NGB_ACCT.CUST_FIELD_3,
T_STG_VLT_NGB_ACCT.CUST_FIELD_4,
T_STG_VLT_NGB_ACCT.CUST_FIELD_5,
T_STG_VLT_NGB_ACCT.CUST_FIELD_6
FROM
T_STG_VLT_NGB_ACCT ,
 T_STG_VLT_NGB_BUS_ACCT_GRP AG,
 T_STG_VLT_NGB_BUS_ACCT_GRP PAG,
 T_STG_VLT_NGB_BUS_ACCT_GRP GPAG,
 T_STG_VLT_MDM_LE_ARCH ,
 T_STG_VLT_MDM_ACCT_TYPE,
 T_STG_VLT_MDM_BANK_ARCHV BNK,
 T_STG_VLT_MDM_BANK_ARCHV BR,
 T_STG_VLT_MDM_LE_ME_MAP,
 T_STG_VLT_NGB_CASHPL_PRTCP_HST
WHERE
T_STG_VLT_NGB_ACCT.BUS_ACCT_GRP_ID = AG.BUS_ACCT_GRP_ID(+)
AND AG.PARENT_BG_ID=PAG.BUS_ACCT_GRP_ID(+)
AND PAG.PARENT_BG_ID=GPAG.BUS_ACCT_GRP_ID(+)
AND T_STG_VLT_NGB_ACCT.MDM_LE_ID = T_STG_VLT_MDM_LE_ARCH.PARTY_ID(+)
AND T_STG_VLT_NGB_ACCT.MDM_LE_ID_EFF_DATE = T_STG_VLT_MDM_LE_ARCH.PARTY_EFF_DATE(+)
and T_STG_VLT_NGB_ACCT.ACCT_TYPE_ID = T_STG_VLT_MDM_ACCT_TYPE.ACCT_TYPE_ID(+)
AND T_STG_VLT_NGB_ACCT.MDM_BANK_ID = BNK.BANK_ID(+)
AND T_STG_VLT_NGB_ACCT.MDM_BANK_ID_EFF_DATE = BNK.ARCHIVE_RECORD_EFFECTIVE_DATE(+)
AND T_STG_VLT_NGB_ACCT.MDM_BRANCH_ID = BR.BANK_ID(+)
AND T_STG_VLT_NGB_ACCT.MDM_BRANCH_ID_EFF_DATE = BR.ARCHIVE_RECORD_EFFECTIVE_DATE(+)
and T_STG_VLT_NGB_ACCT.MDM_ME_ID = T_STG_VLT_MDM_LE_ME_MAP.ME_LE_MAP_ID(+)
/*and (VLT_NGB_ACCT.ACCT_CLOS_DATE >= to_date('01/01/2010','mm/dd/yyyy')
  OR VLT_NGB_ACCT.ACCT_CLOS_DATE IS NULL) -----> Condition commented on 28-05-2012*/  
  AND T_STG_VLT_NGB_ACCT.ACCT_ID = T_STG_VLT_NGB_CASHPL_PRTCP_HST.ACCT_ID(+)
  and T_STG_Vlt_Ngb_Acct.eff_start_date = T_STG_VLT_NGB_CASHPL_PRTCP_HST.eff_start_date(+)





/*=====================================================================================================================================
                                        TARGET - EDW
===================================================================================================================================== */

SELECT BANK_ACCT_KEY,
  BANK_ACCT_ID,
  TREAS_CODE,
  ACCT_NBR_TEXT,
  ACCT_OPEN_DATE,
  ACCT_CLOS_DATE,
  ACCT_PURP_DESC,
  ACCT_TYPE_CODE,
  ACCT_TYPE_NM,
  ACCT_CURR_CODE,
  ACCT_USED_BY_GE_FLAG,
  ACCT_HOLD_NM,
  ACCT_IDNTY_TYPE_CODE,
  ACCT_VALID_FLAG,
  ACCT_REF_AACCTMAP_DESC,
  ACCT_REF_AGRADSCT_DESC,
  ACCT_REF_ASWEEP_DESC,
  ACCT_REF_AGLACCT_DESC,
  ACCT_REF_AGRADSDD_DESC,
  PARNT_BCD,
  PARNT_BANK_NM,
  BANK_NM,
  BANK_SHORT_NM,
  BANK_ADDR_1_TEXT,
  BANK_ADDR_2_TEXT,
  BANK_ADDR_3_TEXT,
  BANK_ADDR_4_TEXT,
  BANK_CITY_NM,
  BANK_STA_NM,
  BANK_PCDE,
  BANK_CNTRY_CODE,
  BANK_CNTRY_NM,
  BANK_ACTV_FLAG,
  PREF_BANK_FLAG,
  BR_SHORT_NM,
  BR_DESC,
  BR_ADDR_TEXT,
  BR_CITY_NM,
  BR_STA_NM,
  BR_PCDE,
  BR_CNTRY_CODE,
  BR_ACTV_FLAG,
  MNGMT_ENT_CODE,
  LGL_ENT_GOLD_ID_CODE,
  SRCE_SYS_CODE,
  SRCE_SYS_NM,
  EFF_DATE,
  EXPIRN_DATE,
  ACTV_FLAG,
  ACCT_MNGMT_CODE,
  GRND_PARNT_BUS_GRP_NAME,
  GRND_PARNT_BUS_GRP_CODE,
  GRND_PARNT_BUS_GRP_DESC,
  PARNT_BUS_GRP_NAME,
  PARNT_BUS_GRP_CODE,
  PARNT_BUS_GRP_DESC,
  BUS_GRP_NAME,
  BUS_GRP_CODE,
  BUS_GRP_DESC,
  BSLA_TYPE_CODE,
  BSLA,
  DR4,
  ACCT_STATUS_DESC,
  IS_CASH_POOL_FLAG,
  RGN_ID,
  INTL_ACCT_NBR,
  NATL_ACCT_NBR,
  CORP_POOLHDR_CHAR_VAL,
  CASH_POOLHDR_PRTCPT_VAL,
  ACCT_TITL_NM,
  FC_CODE,
  BCD ,
  BR_CODE ,
  SRCE_SYS_MARS_LE_CODE ,
  BUS_DEFN_FIELD_1 ,
  BUS_DEFN_FIELD_2 ,
  BUS_DEFN_FIELD_3 ,
  BUS_DEFN_FIELD_4 ,
  BUS_DEFN_FIELD_5 ,
  BUS_DEFN_FIELD_6 
  --OVNT_SWEEP_FLAG
FROM EDW.T_DIM_BANK_ACCT
WHERE ACTV_FLAG    ='Y'
AND SRCE_SYS_CODE IN ('WB','VLT','WB_VLT')
